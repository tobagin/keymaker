using Gtk 4.0;
using Adw 1;

template $KeyMakerConnectionTestDialog : Adw.Dialog {
  title: _("Connection Test");
  content-width: 800;
  content-height: 600;

  content: Gtk.Box {
    orientation: vertical;
    
    Adw.HeaderBar {
      title-widget: Adw.WindowTitle {
        title: _("SSH Connection Test");
        subtitle: _("Test SSH connectivity and diagnose issues");
      };
    }

    Stack main_stack {
      vexpand: true;
      
      Adw.StatusPage initial_page {
        name: "initial";
        title: _("Test SSH Connection");
        description: _("Enter connection details to test SSH connectivity");
        icon-name: "network-wired-symbolic";
        
        child: Adw.Clamp {
          maximum-size: 500;
          tightening-threshold: 300;
          
          Box {
            orientation: vertical;
            spacing: 24;
            margin-top: 24;
            margin-bottom: 24;
            margin-start: 12;
            margin-end: 12;
            
            Adw.PreferencesGroup {
              title: _("Connection Details");
              
              Adw.EntryRow hostname_row {
                title: _("Hostname");
                text: "";
              }
              
              Adw.EntryRow username_row {
                title: _("Username");
                text: "";
              }
              
              Adw.SpinRow port_row {
                title: _("Port");
                subtitle: _("SSH port number");
                adjustment: Adjustment {
                  lower: 1;
                  upper: 65535;
                  value: 22;
                  step-increment: 1;
                  page-increment: 100;
                };
              }
            }
            
            Adw.PreferencesGroup {
              title: _("Authentication");
              
              Adw.ActionRow identity_file_row {
                title: _("Identity File");
                subtitle: _("SSH private key file");
                activatable: true;
                
                [suffix]
                Box {
                  orientation: horizontal;
                  spacing: 6;
                  
                  Label identity_file_label {
                    label: _("None selected");
                    styles ["dim-label"]
                  }
                  
                  Image {
                    icon-name: "go-next-symbolic";
                  }
                }
              }
              
              Adw.EntryRow proxy_jump_row {
                title: _("Proxy Jump");
                text: "";
              }
            }
            
            Adw.PreferencesGroup {
              title: _("Options");
              
              Adw.SpinRow timeout_row {
                title: _("Timeout (seconds)");
                subtitle: _("Connection timeout");
                adjustment: Adjustment {
                  lower: 5;
                  upper: 120;
                  value: 10;
                  step-increment: 1;
                  page-increment: 10;
                };
              }
            }
            
            Box {
              orientation: horizontal;
              spacing: 12;
              halign: end;
              
              Button close_button {
                label: _("Close");
              }
              
              Button test_button {
                label: _("Test Connection");
                sensitive: false;
                styles ["suggested-action"]
              }
            }
          }
        };
      }
      
      Box testing_page {
        name: "testing";
        orientation: vertical;
        spacing: 24;
        halign: center;
        valign: center;
        
        Spinner testing_spinner {
          spinning: false;
          width-request: 48;
          height-request: 48;
        }
        
        Label testing_status {
          label: _("Testing connection...");
          styles ["title-2"]
        }
        
        Button {
          label: _("Cancel");
          halign: center;
          styles ["pill"]
        }
      }
      
      Box results_page {
        name: "results";
        orientation: vertical;
        
        Adw.Clamp {
          maximum-size: 800;
          tightening-threshold: 600;
          vexpand: true;
          
          Box {
            orientation: vertical;
            spacing: 24;
            margin-top: 24;
            margin-bottom: 24;
            margin-start: 12;
            margin-end: 12;
            
            Adw.PreferencesGroup {
              title: _("Test Result");
              
              Adw.ActionRow result_row {
                [prefix]
                Image result_icon {
                  icon-name: "emblem-ok-symbolic";
                  icon-size: large;
                }
                
                [suffix]
                Box {
                  orientation: vertical;
                  spacing: 6;
                  
                  Label result_title {
                    label: _("Connection Successful");
                    halign: start;
                    styles ["heading"]
                  }
                  
                  Label result_subtitle {
                    label: _("user@hostname:22");
                    halign: start;
                    styles ["dim-label"]
                  }
                }
              }
            }
            
            Adw.PreferencesGroup {
              title: _("Connection Details");
              
              Adw.ExpanderRow details_row {
                title: _("Technical Details");
                subtitle: _("Connection information and diagnostics");
                
                ListBox details_list {
                  selection-mode: none;
                  styles ["boxed-list"]
                }
              }
            }
            
            Box {
              orientation: horizontal;
              spacing: 12;
              halign: end;
              
              Button {
                label: _("Test Again");
                action-name: "test-again";
              }
              
              Button {
                label: _("Close");
                styles ["suggested-action"]
              }
            }
          }
        }
      }
    }
  };
}